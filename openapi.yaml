openapi: 3.1.0
info:
  title: API Busca de Produtos - Stevo Integration
  description: |
    API para buscar produtos do catálogo Magazord via Stevo IA.
    
    **IMPORTANTE**: Você DEVE sempre fornecer pelo menos um parâmetro de busca.
    Não envie requisições sem parâmetros.
  version: 1.0.0
  contact:
    name: Suporte
    
servers:
  - url: https://zweu.vercel.app
    description: Servidor de Produção

paths:
  /api/buscar-produto:
    post:
      operationId: buscarProduto
      summary: Buscar produtos no catálogo
      description: |
        Busca produtos no catálogo do Magazord.
        
        **INSTRUÇÕES CRÍTICAS**:
        - Você DEVE fornecer pelo menos um parâmetro: nome, codigo, produto ou mensagem
        - Se o usuário perguntar "tem jaleco?", envie: nome="jaleco"
        - Se o usuário perguntar "produto X123", envie: codigo="X123"
        - NUNCA envie requisição sem parâmetros
        
        **EXEMPLOS**:
        - Cliente: "tem jaleco?" → { "nome": "jaleco", "limit": 10 }
        - Cliente: "mostra gorro azul" → { "nome": "gorro azul", "limit": 10 }
        - Cliente: "código 300-MC-049" → { "codigo": "300-MC-049", "limit": 1 }
        - Cliente: "quero 5 aventais" → { "nome": "avental", "limit": 5 }
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                  description: Nome ou palavra-chave do produto (ex. "jaleco", "gorro azul")
                  example: "jaleco"
                codigo:
                  type: string
                  description: Código exato do produto
                  example: "300-MC-049"
                produto:
                  type: string
                  description: Termo alternativo para nome do produto
                  example: "avental"
                mensagem:
                  type: string
                  description: Mensagem completa do usuário (será processada)
                  example: "preciso de um jaleco branco"
                limit:
                  type: integer
                  description: Quantidade máxima de produtos a retornar
                  default: 10
                  minimum: 1
                  maximum: 50
                  example: 10
              # Pelo menos um desses campos deve ser fornecido
              anyOf:
                - required: [nome]
                - required: [codigo]
                - required: [produto]
                - required: [mensagem]
            examples:
              busca_por_nome:
                summary: Buscar por nome
                value:
                  nome: "jaleco"
                  limit: 10
              busca_por_codigo:
                summary: Buscar por código
                value:
                  codigo: "300-MC-049"
                  limit: 1
              busca_por_termo:
                summary: Buscar por termo genérico
                value:
                  produto: "gorro azul"
                  limit: 5
                  
      responses:
        '200':
          description: Produtos encontrados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                    example: true
                  total_produtos:
                    type: integer
                    description: Total de produtos encontrados
                    example: 15
                  produtos:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 12345
                        codigo:
                          type: string
                          example: "300-MC-049"
                        nome:
                          type: string
                          example: "Jaleco Branco Manga Longa"
                        ativo:
                          type: boolean
                          example: true
                        preco:
                          type: number
                          format: float
                          example: 89.90
                        preco_promocional:
                          type: number
                          format: float
                          nullable: true
                          example: 69.90
                        estoque_disponivel:
                          type: integer
                          example: 50
                        imagens:
                          type: array
                          items:
                            type: object
                            properties:
                              url:
                                type: string
                                format: uri
                                example: "https://example.com/imagem.jpg"
                              principal:
                                type: boolean
                                example: true
                        derivacoes:
                          type: array
                          description: Variações do produto (tamanhos, cores, etc)
                          items:
                            type: object
                            properties:
                              codigo:
                                type: string
                                example: "300-MC-049-P"
                              nome:
                                type: string
                                example: "Tamanho P"
                              estoque:
                                type: integer
                                example: 10
                              preco:
                                type: number
                                example: 89.90
                  busca_realizada:
                    type: object
                    properties:
                      termo:
                        type: string
                        example: "jaleco"
                      limit:
                        type: integer
                        example: 10
                        
        '400':
          description: Parâmetros inválidos ou ausentes
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Parâmetro obrigatório não fornecido"
                  mensagem:
                    type: string
                    example: "Você deve fornecer pelo menos um dos parâmetros: nome, codigo, produto ou mensagem"
                  parametros_recebidos:
                    type: object
                  exemplo:
                    type: object
                    example:
                      nome: "jaleco"
                      limit: 10
                      
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Erro interno do servidor"
                  mensagem:
                    type: string
                    example: "Detalhes do erro"

components:
  schemas: {}
  
x-stevo-instructions: |
  INSTRUÇÕES PARA O STEVO IA:
  
  1. Quando o cliente perguntar sobre produtos, SEMPRE chame esta ferramenta
  2. NUNCA envie requisição sem parâmetros
  3. Extraia o termo de busca da mensagem do cliente
  4. Use o parâmetro "nome" para termos genéricos
  5. Use o parâmetro "codigo" para códigos específicos
  6. Sempre adicione "limit" (padrão: 10)
  
  EXEMPLOS PRÁTICOS:
  - "tem jaleco?" → nome="jaleco", limit=10
  - "mostra gorro" → nome="gorro", limit=10
  - "código X123" → codigo="X123", limit=1
  - "quero ver 20 aventais" → nome="avental", limit=20
